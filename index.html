<!DOCTYPE html>
<html>
<head>
  <title>Route from A to B</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <style>
    body, html { margin: 0; padding: 0; }
    #map { height: 90vh; width: 100%; }
    #controls {
      padding: 10px;
      background: #f0f0f0;
    }
    input { margin: 4px; padding: 5px; }
    button { padding: 6px 10px; }
  </style>
</head>
<body>

<div id="controls">
  <input id="startLat" type="text" placeholder="Start Latitude" />
  <input id="startLng" type="text" placeholder="Start Longitude" />
  <input id="endLat" type="text" placeholder="End Latitude" />
  <input id="endLng" type="text" placeholder="End Longitude" />
  <button onclick="getRoute()">Draw Route</button>
  <button onclick="useGPS()">Use My Location</button>
</div>

<div id="map"></div>

<!-- Leaflet -->
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

<script>
  const map = L.map('map').setView([23.03, 72.58], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
  }).addTo(map);

  let routeLine = null;
  let startMarker = null, endMarker = null;

  async function getRoute() {
    const startLat = parseFloat(document.getElementById("startLat").value);
    const startLng = parseFloat(document.getElementById("startLng").value);
    const endLat = parseFloat(document.getElementById("endLat").value);
    const endLng = parseFloat(document.getElementById("endLng").value);

    if (isNaN(startLat) || isNaN(startLng) || isNaN(endLat) || isNaN(endLng)) {
      alert("Enter valid coordinates.");
      return;
    }

    if (startMarker) map.removeLayer(startMarker);
    if (endMarker) map.removeLayer(endMarker);
    if (routeLine) map.removeLayer(routeLine);

    startMarker = L.marker([startLat, startLng]).addTo(map).bindPopup("Start").openPopup();
    endMarker = L.marker([endLat, endLng]).addTo(map).bindPopup("End");

    const apiKey = "5b3ce3597851110001cf624851251b0ba51a41d9800fbb30dac99a4c"; // OpenRouteService public demo key
    const url = `https://api.openrouteservice.org/v2/directions/driving-car?api_key=${apiKey}&start=${startLng},${startLat}&end=${endLng},${endLat}`;

    try {
      const res = await fetch(url);
      const json = await res.json();
      const coords = json.features[0].geometry.coordinates.map(c => [c[1], c[0]]);
      routeLine = L.polyline(coords, { color: "blue" }).addTo(map);
      map.fitBounds(routeLine.getBounds());
    } catch (err) {
      alert("Error fetching route.");
      console.error(err);
    }
  }

  function useGPS() {
    if ("geolocation" in navigator) {
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        document.getElementById("startLat").value = lat.toFixed(6);
        document.getElementById("startLng").value = lng.toFixed(6);
      }, err => {
        alert("GPS error");
      });
    } else {
      alert("GPS not supported.");
    }
  }
</script>

</body>
</html>
