<!DOCTYPE html>
<html>
<head>
  <title>GPS Live Tracker Map</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <style> #map { height: 100vh; width: 100%; } body { margin: 0; } </style>
</head>
<body>
<div id="map"></div>

<!-- Leaflet -->
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // 🔐 Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBesWChEdJEZRFRkXE8rpynY0lBez47SJA",
    authDomain: "myindiamapamritkal.firebaseapp.com",
    databaseURL: "https://myindiamapamritkal-default-rtdb.firebaseio.com",
    projectId: "myindiamapamritkal",
    storageBucket: "myindiamapamritkal.firebasestorage.app",
    messagingSenderId: "830924864737",
    appId: "1:830924864737:web:7a096f506d004e19358ba0"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // 🗺️ Initialize map
  const map = L.map('map').setView([23.03, 72.58], 13); // Ahmedabad default
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
  }).addTo(map);

  const myId = "user_" + Math.floor(Math.random() * 10000); // unique ID per browser
  const markers = {};

  // 🛰️ Get your live GPS position
  if ("geolocation" in navigator) {
    navigator.geolocation.watchPosition(pos => {
      const { latitude, longitude } = pos.coords;

      // Save to Firebase
      db.ref("liveUsers/" + myId).set({
        name: "User " + myId,
        lat: latitude,
        lng: longitude,
        timestamp: Date.now()
      });

    }, err => {
      console.error("Geolocation error:", err);
    }, {
      enableHighAccuracy: true,
      maximumAge: 1000
    });
  } else {
    alert("Geolocation not supported");
  }

  // 🔁 Listen for all live users
  db.ref("liveUsers").on("value", (snapshot) => {
    const users = snapshot.val();
    for (const uid in users) {
      const user = users[uid];
      const latlng = [user.lat, user.lng];

      if (!markers[uid]) {
        markers[uid] = L.marker(latlng).addTo(map)
          .bindPopup(user.name);
      } else {
        markers[uid].setLatLng(latlng);
      }
    }
  });
</script>
</body>
</html>
